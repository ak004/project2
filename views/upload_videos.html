<%- include('header.html'); -%>

<div class="content-page">
    <div class="container-fluid">
       <div class="row">
           <div class="col-lg-12">
               <div class="card">
                   <div class="card-body">
                       <div class="d-flex flex-wrap align-items-center justify-content-between breadcrumb-content">
                           <h5>Your Videos </h5>
                           <div class="d-flex flex-wrap align-items-center justify-content-between">
                            <form id="query_form" name="query_form" action="/modules" method="post" >
                                <div class="form-group mb-3" style="margin-right: 20px; margin-top: 20px;">
                                    <select name="status2" class="selectpicker form-control" id="status2"   data-style="py-0">
                                      <%if(status && status == "active") {%>
                                        <option value="active" selected>Active</option>
                                        <option value="suspended" >Suspended</option>
                                        <%}else if(status && status == "suspended") {%>
                                            <option value="active" >Active</option>
                                            <option value="suspended" selected>Suspended</option>
                                            <%}else {%>
                                                <option value="active" selected>Active</option>
                                                <option value="suspended" >Suspended</option>
                                                <%}%>
                                     
                                    </select>
                                </div>
                            </form> 
                              
                               <div class="list-grid-toggle d-flex align-items-center mr-3">
                                   <div data-toggle-extra="tab" data-target-extra="#grid" class="active">
                                       <div class="grid-icon mr-3">
                                           <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                               <rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>
                                           </svg>
                                       </div>
                                   </div>
                                
                               </div>
                               <div class="pl-3 border-left btn-new">
                                   <a href="#" class="btn btn-primary"   onclick="openmodel()" data-toggle="modal">New Video</a>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <%if(modules.length <= 0) {%>
       <center>
        <h1 style="font-weight: bold; "> Please Create a Module first to upload videos under it</h1>
       </center>
       <%}else {%>
       <div id="grid" class="item-content animate__animated animate__fadeIn active" data-toggle-extra="tab-content">
           <div class="row">
            <div class="col-lg-12">
                <div class="card card-widget task-card">
                    <div class="card-body">
                        <div class="d-flex flex-wrap align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <div class="custom-control custom-task custom-checkbox custom-control-inline">
                                    <img src="images/user/01.jpg" class="img-fluid rounded-circle avatar-90 m-auto" alt="image">
                                </div>
                                <div>
                                    <h5 class="mb-2"> ntinre its longer  </h5>
                                    <div class="media align-items-center">
                                        <div class="btn bg-body mr-3"> <i class="ri-timer-line"></i>2:30 min</div>
                                        <div class="btn bg-body mr-3"><i class="ri-align-justify mr-2"></i>Module: 140</div>
                                        <div class="btn bg-body"><i class="ri-survey-line mr-2"></i>3</div>
                                    </div>
                                </div>
                            </div>
                                <div class="mt-md-0 mt-3" style="  float: right;">
                                  
                                        <a href="#" class="btn bg-secondary-light mr-3">Delete</a>
                                        <a class="btn bg-secondary-light" data-toggle="collapse" href="#collapseEdit1" role="button" aria-expanded="false" aria-controls="collapseEdit1"><i class="ri-edit-box-line m-0"></i></a>
                                     
                               </div>
                        </div>  
                    </div>
                </div>                       
            </div>
           </div>
       </div>

       <%}%>
       
       <!-- Page end  -->
   </div>
</div>

    <!-- Modal list start -->
    <div class="modal fade bd-example-modal-lg" role="dialog" aria-modal="true" id="new-project-modal">
        <div class="modal-dialog    modal-lg"  >
            <div class="modal-content">
                <div class="modal-header d-block text-center pb-3 border-bttom">
                    <h3 class="modal-title" id="exampleModalCenterTitle01">New Video</h3>
                </div>
                <div class="modal-body">
                    <form id="new_restuarant"   action="/upload_videos"  name="new_restuarant" method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-lg-12">
                            <input type="hidden" id="_id" name="_id" />
                            <p style="color: red;" id="mes"></p>
                            <div class="form-group mb-3">
                                <label for="exampleInputText01" class="h5">Video Title*</label>
                                <input type="text" class="form-control" id="m_title" name="m_title" placeholder="Module Name">
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group mb-3">
                                <label for="exampleInputText2" class="h5">Module*</label>
                                <select name="m_module" class="selectpicker form-control" id="m_module" data-style="py-0" required>
                                    <option value="">Select a Module</option>
                                    <% modules.forEach(function(md) { %>
                                    <option value="<%=md._id%>"><%=md.title%></option>
                                        <%})%>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group mb-3">
                                <label for="exampleInputText2" class="h5">Status*</label>
                                <select name="status" class="selectpicker form-control" id="status"  data-style="py-0" required>
                                    <option value="active">Active</option>
                                    <option value="suspended">Suspended</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group mb-3">
                                <label for="exampleInputText004" class="h5">Module Sequence*</label>
                                <input type="number" class="form-control" id="seq" name="seq">
                            </div>                        
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group mb-3">
                                <label for="exampleInputText004" class="h5">Hours*</label>
                                <input type="number" class="form-control" id="hours" name="hours">
                            </div>                        
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group mb-3">
                                <label for="exampleInputText004" class="h5">Mintues*</label>
                                <input type="number" class="form-control" id="min" name="min">
                            </div>                        
                        </div>

                        <div class="col-lg-6">
                            <label for="exampleInputText004" class="h5">Thumb Image*</label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                   <span class="input-group-text">Upload</span>
                                </div>
                                <div class="custom-file">
                                   <input type="file" class="custom-file-input"  name="res_image" id="imageUpload" accept=".png, .jpg, .jpeg" >
                                   <label class="custom-file-label selected" style="  white-space: nowrap;  overflow: hidden; text-overflow: ellipsis; max-width: 100%;"  id="input_namee" ></label>
                                </div>
                             </div>
                    </div>

                    <div class="col-lg-6">
                        <label for="exampleInputText004" class="h5">Attachments</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                               <span class="input-group-text">Upload</span>
                            </div>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" name="attachment" id="attachment" accept="application/pdf,application/msword,application/vnd.ms-excel">
                               <label class="custom-file-label selected" style="  white-space: nowrap;  overflow: hidden; text-overflow: ellipsis; max-width: 100%;"  id="input_namee2" ></label>
                            </div>
                         </div>
                </div>

                <div class="col-lg-12">
                    <label for="exampleInputText004" class="h5"> Video*</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                           <span class="input-group-text">Upload</span>
                        </div>
                        <div class="custom-file">
                           <input type="file" class="custom-file-input"  name="res_image" id="imageUpload" accept=".png, .jpg, .jpeg" >
                           <label class="custom-file-label selected" style="  white-space: nowrap;  overflow: hidden; text-overflow: ellipsis; max-width: 100%;"  id="input_namee" ></label>
                        </div>
                     </div>
            </div>
                       
                        <div class="col-lg-12">
                            <div class="form-group mb-3">
                                <label for="exampleInputText07" class="h5">Description*</label>
                               <textarea class="form-control" name="desc" id="desc" rows="3"  >

                               </textarea>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="d-flex flex-wrap align-items-ceter justify-content-center mt-2">
                                <div class="btn btn-primary mr-3"   onclick="save_modeule()" >Save</div>
                                <div class="btn btn-primary" data-dismiss="modal">Cancel</div>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
<%- include('footer.html'); -%>


<script>
 
$("#status2").change(function () {
    $('#query_form').submit();
    });

    function save_modeule() {
        let _id = $("#_id").val();
        let title = $("#m_title").val();
        let price = $("#price").val();
        let status = $('#status').val();
        let hours = $('#hours').val();
        let min = $('#min').val();
        let desc = $('#desc').val();
        if(min.length > 2 || min > 59) {
                $('#mes').text("Please put a propor duration");
            }  else {
                if (title.length === 0 || price.length === 0 || status.length === 0 || hours.length === 0 || min.length === 0 || desc.length === 0) {
            $('#mes').text("Please fill the required fields");
        } else {
            $.ajax({
                url: '/save_modules',
                type: 'post',
                data: {
                    _id:_id,
                    title:title,
                    price:price,
                    status:status,
                    hours:hours,
                    min:min,
                    desc:desc,
                },
                dataType: "json",
                success: function(res) {
                    if(res.success) {
                    window.location.reload(true);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
                });
            }
        }
    
        
    }
   
    function deltelte_module(id) {
        $.ajax({
                url: '/delete_modules',
                type: 'post',
                data: {
                    _id: id
                },
                beforeSend: function () {
                    return confirm("Are you sure? all of the videos under this module will be deleted");
                },
                dataType: "json",
                success: function(res) {
                    if(res.success) {
                        Swal.fire(res.message);
                    window.location.reload(true);
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
                });
    }

    function edit_modeule(id,title,description,price,duration,status) {
        let minss = duration.split(":")[1];
        let hourss = duration.split(":")[0];
        console.log("the duration", typeof(hourss));
        console.log("the minn", typeof(minss));
        let status_val ;
        if(status === "2") {
            status_val = "active";
        }else {
            status_val = "suspended";
        }
        $('#_id').val(id);
        $('#m_title').val(title);
        $('#price').val(price);
        $('#hours').val(Number(hourss));
        $('#min').val(Number(minss));
        $('#desc').val(description);
        $('#status').val(status_val).change();
        $('#new-project-modal').modal('show');
    }

    function openmodel() {
        $('#_id').val("");
        $('#m_title').val("");
        $('#price').val("");
        $('#status').val("active").change();
        $('#hours').val("");
        $('#min').val("");
        $('#desc').val("");
        $('#new-project-modal').modal('show');
    }
</script>